# 📱 Система Telegram админов

## 🆕 Новая система управления уведомлениями

Теперь вместо одного Chat ID используется система Telegram админов, которая позволяет:
- ✅ Добавлять/удалять админов через `manage.sh`
- ✅ Управлять статусом админов (активен/неактивен)
- ✅ Отправлять уведомления всем активным админам
- ✅ Красиво отображать список админов

## 🗄️ База данных

### Таблица `telegram_admins`:
```sql
CREATE TABLE telegram_admins (
    id CHAR(36) PRIMARY KEY DEFAULT (UUID()),
    name VARCHAR(255) NOT NULL,
    chat_id VARCHAR(50) UNIQUE NOT NULL,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

## 🛠️ Управление через manage.sh

### Новые пункты меню:
```
📱 TELEGRAM БОТ:
8) Проверить настройки Telegram бота
9) Добавить Telegram админа
10) Удалить Telegram админа
11) Список Telegram админов
12) Изменить статус Telegram админа
```

### Примеры использования:

#### 1. Добавление админа (пункт 9):
```bash
./manage.sh
# Выберите 9
# Введите имя: Админ
# Введите Chat ID: 123456789
# ✅ Telegram админ 'Админ' добавлен/обновлён
```

#### 2. Список админов (пункт 11):
```
📱 Список Telegram админов:
┌─────────────────────────────────────────────────────────────┐
│ ID                                    │ Имя        │ Chat ID  │ Статус │
├─────────────────────────────────────────────────────────────┤
│ 12345678-1234-1234-1234-123456789012 │ Админ      │ 123456789│ Активен│
│ 87654321-4321-4321-4321-210987654321 │ Менеджер   │ 987654321│ Неактивен│
└─────────────────────────────────────────────────────────────┘
```

#### 3. Удаление админа (пункт 10):
```bash
# Введите Chat ID: 123456789
# Найден админ: Админ
# Вы уверены, что хотите удалить этого админа? (y/N): y
# ✅ Telegram админ удалён
```

#### 4. Изменение статуса (пункт 12):
```bash
# Введите Chat ID: 123456789
# Админ: Админ
# Текущий статус: активен
# Новый статус: неактивен
# Продолжить? (y/N): y
# ✅ Статус админа изменён на 'неактивен'
```

## 🔧 Настройка

### 1. Создайте бота через @BotFather:
```
/newbot
# Введите имя: PYon Studio Bot
# Введите username: pyon_studio_bot
# Скопируйте токен
```

### 2. Получите Chat ID:
1. Отправьте боту сообщение
2. Откройте: `https://api.telegram.org/bot<TOKEN>/getUpdates`
3. Найдите `"chat":{"id":` - это ваш Chat ID

### 3. Настройте .env:
```env
TELEGRAM_BOT_TOKEN=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz
# TELEGRAM_CHAT_ID больше не нужен!
```

### 4. Добавьте админов:
```bash
./manage.sh
# Выберите 9 - Добавить Telegram админа
```

## 📱 Как это работает

### При запуске сервера:
1. Бот инициализируется
2. Получает список всех активных админов из БД
3. Отправляет уведомление о запуске каждому админу
4. Логирует результат отправки

### При получении сообщения из формы:
1. Формируется сообщение
2. Получается список активных админов
3. Сообщение отправляется каждому админу
4. Логируется результат

### Логи:
```
📱 Отправка уведомления 2 Telegram админам...
✅ Уведомление отправлено админу: Админ (123456789)
✅ Уведомление отправлено админу: Менеджер (987654321)
```

## ⚠️ Важные моменты

1. **Chat ID должен содержать только цифры** (может быть отрицательным для групп)
2. **Каждый Chat ID уникален** - нельзя добавить дубликат
3. **Неактивные админы не получают уведомления**
4. **При ошибке отправки одному админу** - остальные получат сообщение
5. **Логи показывают детальную информацию** о каждой отправке

## 🚀 Преимущества новой системы

- ✅ **Множественные админы** - можно добавить несколько человек
- ✅ **Гибкое управление** - включать/выключать админов
- ✅ **Красивый интерфейс** - таблицы и эмодзи в manage.sh
- ✅ **Безопасность** - Chat ID хранятся в БД, а не в .env
- ✅ **Логирование** - подробные логи отправки
- ✅ **Удобство** - все управление через один скрипт

## 🔄 Миграция со старой системы

Если у вас уже был настроен `TELEGRAM_CHAT_ID`:

1. **Добавьте себя как админа:**
   ```bash
   ./manage.sh
   # Выберите 9
   # Имя: Главный админ
   # Chat ID: [ваш старый TELEGRAM_CHAT_ID]
   ```

2. **Удалите из .env:**
   ```env
   # TELEGRAM_CHAT_ID=123456789  # Удалите эту строку
   ```

3. **Перезапустите сервер:**
   ```bash
   ./manage.sh
   # Выберите 3 - Перезапустить сервер
   ```

**Готово! Теперь уведомления будут отправляться всем активным админам! 🎉**
